<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Audio</title>
<script>
  window.addEventListener("DOMContentLoaded", () => {
	const getMic = document.getElementById("mic");
    	const recordButton = document.getElementById("record");
    	const list = document.getElementById("recordings");
	getMic.addEventListener("click", async () => {
        	getMic.setAttribute("hidden", "hidden");
        	const stream = await navigator.mediaDevices.getUserMedia({
            		audio: true,
            		video: false
          	});
		let chunks = [];
          	const recorder = new MediaRecorder(stream, { type: "audio/webm", bitsPerSecond: 32000});
		recorder.addEventListener("dataavailable", event => {
	     		if (typeof event.data === "undefined") return;
	       		if (event.data.size === 0) return;
	       		chunks.push(event.data);
	     	});
	   	recorder.addEventListener("stop", () => {
	     		const recording = new Blob(chunks, { type: mimeType });
	     		renderRecording(recording, list);
	     		chunks = [];
	   	});
		recordButton.removeAttribute("hidden");
         	recordButton.addEventListener("click", () => {
           		if (recorder.state === "inactive") {
             			recorder.start();
             			recordButton.innerText = "Stop";
           		} else {
             			recorder.stop();
             			recordButton.innerText = "Record";
           		}
         	});
	});
  });
  function renderRecording(blob, list) {
    const blobUrl = URL.createObjectURL(blob);
    const audio = document.createElement("audio");
    const now = new Date();
    audio.setAttribute("src", blobUrl);
    audio.setAttribute("controls", "controls");
    list.appendChild(audio);
  }
</script>
</head>
<body>
	<div>
		<div class="controls">
        		<button type="button" id="mic">Get Microphone</button>
        		<button type="button" id="record" hidden>Record</button>
      		</div>
      		<ul id="recordings"></ul>
	</div>
</body>
</html>
